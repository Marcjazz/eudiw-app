name: Build and Deploy
on:
  push:
    branches: 
      - develop

permissions:
  pages: write
  id-token: write
  contents: read

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Checkout deploy branch
        uses: actions/checkout@v4
        with:
          ref: deploy-branch
          clean: false

      - name: Move build output to deploy branch
        run: |
          mv dist/* .
          git add .
          git commit -m "Deploy compiled code"
          git push origin deploy-branch


# jobs:
#   build:
#     # Recommended if you intend to make multiple deployments in quick succession.
#     concurrency: ci-${{ github.ref }}
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout 🛎️
#         uses: actions/checkout@v4
#         # This example project is built using npm and outputs the result to the 'build' folder.
#         # Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
#       - name: Install and Build 🔧
#         run: |
#           npm ci
#           npx nx run wallet-react:build --baseHref=/eudiw-app-dev/

#       - name: Setup Pages 📄🔧
#         id: pages
#         uses: actions/configure-pages@v4
#       - name: Upload artifact
#         uses: actions/upload-pages-artifact@v3
#         with:
#           path: ./dist/apps/wallet-react
#   deploy:
#     environment:
#       name: github-pages
#       url: ${{ steps.deployment.outputs.page_url }}
#     runs-on: ubuntu-latest
#     needs: build
#     steps:
#       - name: Set deployment directory
#         id: set-deploy-dir
#         run: echo "deploy_dir=${{ github.ref_slug }}" >> $GITHUB_ENV
#       - name: Deploy to Github Pages 🚀
#         id: deployment
#         uses: actions/deploy-pages@v4
#         with:
#             branch: ${{ env.deploy_dir }}
#             folder: dist/apps/wallet-react
